# 你不懂JS：作用域和闭包

#第二章：词法作用域

在第一章中，我们将“作用域”定义为一组规定了引擎如何通过变量名查找变量的规则，变量要么在当前作用域中，要么在包含它的嵌套作用域中。

对于作用域是如何工作的，有两种主要的模型来描述。第一种最为大众所熟知，也被绝大多数编程语言所采用，称为**词法作用域**，我们接下来会深入探讨。另一种模型，仍然有一些语言（例如Bash脚本、Perl中的部分模块，等等）在采用，称为**动态作用域**。

动态作用域会在附录A中讲解。我们在此提到它仅仅是为了和词法作用域做一个对比，也就是JavaScript使用的作用域模型。

# 词法分析时间到

如我们在第一章所讨论的那样，一个标准语言编译器的第一个步骤被称为词法分析（也就是分词）。如果你还记得的话，词法分析过程会检查源代码字符组成的字符串，并将一些语义赋给token作为有状态的解析的结果。

正是这一概念提供了什么是词法作用域以及这个名字来自何处这个问题的基础。

我们要再定义一次的话，词法作用域是在词法分析阶段被定义的作用域。换句话说，词法作用域是以变量和代码块被（你）编写的时候的作用域为基础的，因此（大部分）都在词法分析器处理你的代码的时候被固定下来了。

**注：**我们之后会看到一些欺骗词法作用域的方式，从而在词法分析器经过之后仍能修改它，但这种方式将会被抛弃。我们认为最佳对待词法作用域的方式就是完全使它词法化，这样我们就很自然的只会在编写代码的阶段考虑到它了。

让我们考虑一下下面这一块代码：

	function foo(a) {

    var b = a * 2;

    function bar(c) {
        console.log( a, b, c );
    }

    bar(b * 3);
	}
	
	foo( 2 ); // 2, 4, 12

这段示例代码中有三个嵌套作用域。将这些作用域想象成一个装在另一个的气泡能有助于你的理解。

<img src="fig2.png" width="500">

